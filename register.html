<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>小兔鲜儿 - 欢迎注册</title>
  <link rel="stylesheet" href="./css/base.css">
  <link rel="stylesheet" href="./css/common.css">
  <link rel="stylesheet" href="./css/login.css">
</head>

<body>

  <div class="login-header">
    <div class="wrapper">
      <h1><a href="./index.html">小兔鲜儿</a></h1>
    </div>
  </div>

  <div class="login-body">
    <div class="wrapper">
      <div class="login-container">

        <div class="login-title">
          <h3>新用户注册</h3>
        </div>

        <form class="login-form">
          <div class="input-item">
            <input type="text" id="reg-username" placeholder="请输入11位手机号" maxlength="11">
          </div>
          <div class="input-item password-box">
            <input type="password" id="reg-password" placeholder="请设置登录密码">
            <span id="eye-pass" class="eye-icon"></span>
          </div>

          <div class="input-item password-box">
            <input type="password" id="reg-confirm-pass" placeholder="请再次确认密码">
            <span id="eye-confirm" class="eye-icon"></span>
          </div>
          <div class="agreement-box">
            <input type="checkbox" id="agree-check">
            <label for="agree-check">
              我已阅读并同意 <a href="#">《用户服务协议》</a> 和 <a href="#">《隐私政策》</a>
            </label>
          </div>
          <button type="button" class="btn-login" onclick="doRegister()">立即注册</button>

          <div class="other-links" style="justify-content: center; margin-top: 20px;">
            <a href="./login.html">已有账号？去登录</a>
          </div>
        </form>

      </div>
    </div>
  </div>

  <script>
    function doRegister() {
      // 1. 获取输入内容
      const user = document.getElementById('reg-username').value;
      const pass = document.getElementById('reg-password').value;
      const confirmPass = document.getElementById('reg-confirm-pass').value;
      const isAgreed = document.getElementById('agree-check').checked; // 获取勾选状态

      // ================= 核心：合法性检验 =================

      // 2.1 非空检验
      if (!user || !pass) {
        alert('用户名和密码不能为空！');
        return;
      }

      // 2.2 ★新增★：协议勾选检验 (这是合法性的关键)
      if (!isAgreed) {
        alert('请先阅读并勾选《用户协议》和《隐私政策》');
        return;
      }

      // 2.3 ★新增★：手机号格式检验 (正则表达式)
      // ^1 对应以1开头，[3-9] 对应第二位是3-9的数字，\d{9} 对应后面9位任意数字
      const phoneRegex = /^1[3-9]\d{9}$/;
      if (!phoneRegex.test(user)) {
        alert('用户名格式错误！请输入有效的11位手机号码');
        return;
      }

      // 2.4 ★新增★：密码长度检验
      if (pass.length < 6) {
        alert('为了安全，密码长度不能少于6位！');
        return;
      }

      // 2.5 密码一致性检验
      if (pass !== confirmPass) {
        alert('两次输入的密码不一致！');
        return;
      }

      // ================= 3. 存储逻辑 (保持不变) =================
      localStorage.setItem('myUser', user);
      localStorage.setItem('myPass', pass);

      alert('注册成功！您的账号是：' + user);
      location.href = './login.html';
    }
    // ================= 4. 眼睛图标控制 (注册页专用) =================

    // 定义一个通用的切换函数
    function bindToggleEye(eyeId, inputId) {
      const eye = document.getElementById(eyeId);
      const input = document.getElementById(inputId);

      // 如果找不到元素（防止报错），直接结束
      if (!eye || !input) return;

      // 防止点击图标时输入框失去焦点
      eye.addEventListener('mousedown', function (e) {
        e.preventDefault();
      });

      // 点击切换显示/隐藏
      eye.addEventListener('click', function () {
        if (input.type === 'password') {
          input.type = 'text';       // 变成明文
          eye.classList.add('active'); // 眼睛变橙色
        } else {
          input.type = 'password';   // 变回密文
          eye.classList.remove('active'); // 眼睛变回灰色
        }
      });
    }

    // 调用函数，分别绑定两个框
    bindToggleEye('eye-pass', 'reg-password');      // 绑定第一个框
    bindToggleEye('eye-confirm', 'reg-confirm-pass'); // 绑定第二个框
  </script>

</body>

</html>